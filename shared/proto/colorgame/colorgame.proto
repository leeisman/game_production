syntax = "proto3";

package colorgame;

option go_package = "github.com/frankieli/game_product/shared/proto/colorgame";

import "shared/proto/common/common.proto";

// ColorGameService defines the interface for GS operations
service ColorGameService {
  // PlaceBet handles placing a bet
  rpc PlaceBet(PlaceBetReq) returns (PlaceBetRsp);

  // GetState returns the current game state
  rpc GetState(GetStateReq) returns (GetStateRsp);
}

// GameMachineService defines the interface for GMS
service GameMachineService {
  // RecordBet records a bet
  rpc RecordBet(RecordBetReq) returns (RecordBetRsp);

  // GetCurrentRound gets the current round
  rpc GetCurrentRound(GetCurrentRoundReq) returns (GetCurrentRoundRsp);

  // SubscribeEvents subscribes to game events
  rpc SubscribeEvents (SubscribeEventsReq) returns (stream GameEvent);
}

message PlaceBetReq {
  int64 user_id = 1;
  string color = 2;
  int64 amount = 3;
}

message PlaceBetRsp {
  common.ErrorCode error_code = 1;
  string bet_id = 2;
  string error = 3;
}

message GetStateReq {
  int64 user_id = 1;
}

message GetStateRsp {
  common.ErrorCode error_code = 1;
  bytes state_json = 2;
}

message RecordBetReq {
  string round_id = 1;
  int64 user_id = 2;
  string color = 3;
  int64 amount = 4;
}

message RecordBetRsp {
  common.ErrorCode error_code = 1;
  string error = 2;
}

message GetCurrentRoundReq {
  int64 user_id = 1;
}

message PlayerBet {
  string color = 1;
  int64 amount = 2;
}

message GetCurrentRoundRsp {
  common.ErrorCode error_code = 1;
  string round_id = 2;
  string state = 3;
  int64 betting_end_timestamp = 4;
  repeated PlayerBet player_bets = 5;
}

message SubscribeEventsReq {}

enum EventType {
  EVENT_TYPE_UNSPECIFIED = 0;
  EVENT_TYPE_ROUND_STARTED = 1;
  EVENT_TYPE_BETTING_STARTED = 2;
  EVENT_TYPE_DRAWING = 3;
  EVENT_TYPE_RESULT = 4;
  EVENT_TYPE_ROUND_ENDED = 5;
  EVENT_TYPE_SETTLEMENT = 6;
  EVENT_TYPE_SETTLEMENT_COMPLETE = 7;
  EVENT_TYPE_BET_PLACED = 8;
  EVENT_TYPE_BET_ERROR = 9;
  EVENT_TYPE_GAME_STATE = 10;
  EVENT_TYPE_STATE_ERROR = 11;
  EVENT_TYPE_MACHINE_STOPPED = 12;
}

message GameEvent {
  EventType type = 1;
  string round_id = 2;
  string data = 3;
  int64 timestamp = 4;
}
